<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Squallord's Blog</title>
		<link rel="stylesheet" type="text/css" href="/css/main.css">
		<link href="https://fonts.googleapis.com/css?family=Open+Sans|Ubuntu|Droid" rel="stylesheet">
		<link href="/css/syntax.css" rel="stylesheet">
	</head>
	
	<body>
		<header class="top-container">
		<div class="top-left">
			<h1><a href="/index.html">Squallord's Blog</a></h1>
		</div>
		<div class="top-right">
			<nav>
	<ul class="nav nav-top">
		<li><a href="/" class="">Home</a></li>
		<li><a href="/news" class="current">News</a></li>
		<li><a href="/portfolio" class="">Portfolio</a></li>
		<li><a href="/about" class="">About</a></li>
	</ul>
</nav>
		</div>
		</header>

		<div class="container">
			<div class="sidebar">
				<p>Topics:</p>
<ul>

	<li><a href="/news/Programming.html">Programming</a></li>

	<li><a href="/news/2D Art.html">2D Art</a></li>

	<li><a href="/news/3D Art.html">3D Art</a></li>

</ul>
<hr>
<div class="portrait-anim"></div>
<p>About me:</p>
<p>Computer Engineer and Programmer. I love to mess with fun stuff. Nice to meet you! I hope you enjoy my blog and find something useful.</p>
<hr>
<p>E-mail me at:</p>
<p>squallordis@gmail.com</p>
			</div>

			<div class="content">
				<h2 id="the-idea-behind-my-mosaic-gallery-algorithm---part-i">The idea behind my mosaic gallery algorithm - Part I</h2>

<p>Tho see the functionality of this program, please see <a href="/news/2017/03/22/how-to-use-my-mosaic-photo-gallery-algorithm.html" style="text-decoration: none; color: darkblue"><strong>this</strong></a> before reading the article below.</p>

<p>This idea began with my girlfriend asking me if I could make a photo collage to celebrate our first dating anniversary. So, I began to look for some solutions for this problem (including existing programs that already solved this) and <a href="http://blog.vjeux.com/2012/image/image-layout-algorithm-lightbox-android.html" style="text-decoration: none; color: darkblue"><strong>this article</strong></a> caught my eye. The basic idea seemed pretty simple and I was already looking for some program to build using the Python language. However, I wanted to place the photos with as less restrictions as possible to make it feel more “organic”.</p>

<p>Image manipulation is very expensive, so I thought I could build a simulator (kind of) using only numbers in a <strong>txt</strong> file. The process is pretty straightforward and we’ll go through it step by step. So, let’s begin with the very first foundation: the <strong>image canvas</strong>. The <strong>image canvas</strong> is an entity created to abstract the final image that will hold all photos together. This abstraction is achieved by representing each piece of a picture with a <strong>cluster</strong>. A <strong>cluster</strong> has a width and height in pixels and will depend both on the paperSize and the <em>clusterPow</em> attribute. A <strong>chunk</strong> is a collection of <strong>clusters</strong> that represents an image in this <strong>image canvas</strong> enviroment.</p>

<p>The canvas is built in a way that it has <strong>minimal chunk pieces</strong> times <strong>minimal chunk pieces</strong> both in <strong>width</strong> and <strong>height</strong>. A <strong>minimal chunk piece</strong> is evaluated by computing the expression <strong>2^clusterPow</strong> and it corresponds to the <strong>smallest possible picture</strong> in <strong>width</strong> and <strong>height</strong> <strong>clusters units</strong>.</p>

<p>“What the hell?!” you might be thinking now. Let’s see an example. Imagine you’ve set <strong>clusterPow</strong> to <strong>3</strong>. That will produce a minimal chunk of <strong>2^3</strong> by <strong>2^3</strong> or <strong>8</strong> by <strong>8</strong> clusters in size. So, the paper will be split into <strong>8 pieces</strong> of <strong>8 clusters</strong> each in its <strong>width</strong> and <strong>height</strong>, giving us a total of 64 <strong>clusters</strong> in each dimension. The total number of <strong>clusters</strong> in this <strong>image canvas</strong> will be 64 x 64 = 4096 <strong>clusters</strong> (or 8 x 8 = 64 <strong>minimal chunks</strong>). Each picture can be associated with a certain <strong>cluster</strong>. The algoritm works with <strong>4 sizes</strong> of <strong>clusters</strong>, including the <strong>minimal cluster</strong>. There are <strong>2 sizes</strong> for <strong>portrait</strong> and <strong>landscape</strong> images. From the <strong>smallest</strong> to the <strong>largest chunk</strong> we have: (1, 1), (1, 2), (2, 2), (2, 4). The <strong>chunk</strong> (2, 4), for example, means that it’s <strong>2 minimal chunks</strong> in <strong>height</strong> (<strong>two rows</strong> of <strong>minimal chunk</strong>) and <strong>4 minimal chunks</strong> in <strong>width</strong> (<strong>four columns</strong> of <strong>minimal chunk</strong>). In this example, the <strong>minimal chunk</strong> is <strong>8</strong> by <strong>8 clusters</strong> in size, so the <strong>chunk</strong> (2, 4) will be <strong>16</strong> by <strong>32 clusters</strong>. To sum up, we would have:</p>

<ul>
  <li>clusterPow = 3;</li>
  <li>minimal chunk = 8 by 8 clusters;</li>
  <li>size of image canvas = 8 minimal chunks in both width and height, totalizing 64 minimal chunks;</li>
  <li>size of image canvas = 64 clusters in both width and height, totalizing 4096 clusters;</li>
  <li>chunk (1, 1) = 8 by 8 clusters – the smallest portrait picture;</li>
  <li>chunk (1, 2) = 8 by 16 clusters – the smallest landscape picture;</li>
  <li>chunk (2, 2) = 8 by 8 clusters – the largest portrait picture;</li>
  <li>chunk (2, 4) = 8 by 8 clusters – the largest landcape picture.</li>
</ul>

<p>But how these <strong>clusters</strong> and <strong>chunks</strong> translate into image data? The answer is simple. In this example, we split the canvas in <strong>8 pieces</strong> (<strong>minimal chunks</strong>) in its <strong>width</strong> and <strong>height</strong>. If we set the <strong>paperSize</strong> parameter to <strong>A3</strong> = (3512, 4960), each cluster will translate to 3512/64 = <strong>54.875</strong> in <strong>width</strong> and 4960/64 = <strong>77.5</strong> in <strong>height</strong>. Strange, right? Indeed, you don’t need to think about a single <strong>cluster</strong> in pixels because <strong>clusters</strong> are used only to check for <strong>image intersection</strong> (we’ll see it in further detail) and no image will be represented by a single <strong>cluster</strong>. As you know, the smallest possible picture is <strong>8</strong> by <strong>8 clusters</strong> (the <strong>minimal chunk</strong>), which will result in (54.875 x 8) pixels by (77.5 x 8) pixels or <strong>439</strong> pixels by <strong>620</strong> pixels. The other <strong>chunks</strong> are just <strong>linear combinations</strong> of the <strong>smallest chunk</strong> attributes (<strong>width</strong> and <strong>height</strong>). No half pixels!</p>

<p>A blank 64 by 64 <strong>image canvas</strong> should look like this:</p>

<p><img src="/assets/mgallery/blank_canvas_64x64.png" alt="blank canvas 64 x 64" class="center-image drop-shadow-image" /></p>

<p>As the <strong>image canvas</strong> is filled by pictures, the <strong>clusters</strong> numbers changes to match the <strong>ID</strong> of the picture. So, the first picture that the program places in this canvas will have the number <strong>1</strong> assigned to it in every <strong>cluster</strong> that represents the image, the second will have number <strong>2</strong> and so on.</p>

<p>Inside <strong>mgallery folder</strong>, there’s a file called <strong>log_highest.txt</strong>. It contais the <strong>highest rating completed image canvas</strong> and is filled with pictures <strong>IDs</strong>.</p>

<p><img src="/assets/mgallery/filled_canvas_64x64.png" alt="filled canvas 64 x 64" class="center-image drop-shadow-image" /></p>

<p>The picture <strong>bellow</strong> just shows how these numbers <strong>translates</strong> into images:</p>

<p><img src="/assets/mgallery/mosaic_gallery_A4_4px.jpg" alt="mosaic photo gallery example A4" class="center-image drop-shadow-image" /></p>

<p>Let’s take a closer look in this <strong>log_highest.txt</strong> file, just the <strong>upper left</strong> part, for example:</p>

<p><img src="/assets/mgallery/filled_canvas_64x64_upper-left.png" alt="filled canvas upper-left 64 x 64" class="center-image drop-shadow-image" /></p>

<p>Let’s take that beautiful landscape whose <strong>ID</strong> is <strong>5</strong>, for example. It fits the <strong>largest landscape chunk</strong>, so it takes <strong>32 clusters</strong> in <strong>width</strong> and <strong>16 clusters</strong> in <strong>height</strong>, as we expected. Remember that every <strong>cluster</strong> that has <strong>5</strong> assigned to it corresponds to the picture whose <strong>ID</strong> is <strong>5</strong>. If you still find confusing all these numbers mixed togheter, just take a look at the picture <strong>bellow</strong>, where I <strong>highlighted</strong> each sector (image chunk).</p>

<p><img src="/assets/mgallery/filled_canvas_64x64_upper-left_highlighted.png" alt="filled canvas upper-left w/ highlighted 64 x 64" class="center-image drop-shadow-image" /></p>

<p>Hopefully, now you’re getting a better understanding on how I’ve set up this “simulator” to fill the final piece with pictures. We’ll continue to explore how this algorithm work in <strong>Part II</strong> of this article. Hope to see you there!</p>

<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function(){ // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://squallordblog.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
			</div>
		</div>
		<footer>
			<!--<nav>
	<ul class="nav nav-bottom">
		<li><a href="/" class="">Home</a></li>
		<li><a href="/news" class="current">News</a></li>
		<li><a href="/portfolio" class="">Portfolio</a></li>
		<li><a href="/about" class="">About</a></li>
	</ul>
</nav>-->
			<!--<hr>-->
			<p>2017 Squallord's Blog powered by Jekyll.</p>
		</footer>
	</body>
</html>